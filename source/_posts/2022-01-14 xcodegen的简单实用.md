---
title:      "xcodegen相关" 
date:       2022-01-14
tags:
    - iOS
categories:
    - iOS
---+ 

### xcodegen相关

  + 问题：xcode默认打开xxx.xcodeproj工程文件，其本身是一个文件夹，内部存放了project.xcworkspace文件夹，xcshareddata文件夹，xcuserdata文件夹，project.pbxproj文件。本次使用xcodegen生成xcodeproj工程的初衷是为了解决团队开发过程中，project.pbxproj文件冲突难以解决的问题。

  + xcodegen安装：mac `brew install xcodegen`

  + 生成命令：需要在项目根目录创建一个yml格式的文件，使用xcodegen进行生成工程时，默认配置文件为`project.yml`,如果想要自定义，则需要使用`xcodegen --spec xxx.yml`来生成工程

  + 具体语法：

    1. name：项目名称project
    2. configs：对应项目中的configuration，默认Debug和Release，自己可定义configuration并制定debug或release
    3. targets：一个项目下可以有多个target，我的项目暂时只有一个
    4. configFiles: 可以自定义配置xcconfig的路径
    5. TARGETED_DEVICE_FAMILY: 1是iPhone，2是iPad，可以都写上
    6. ASSETCATALOG_COMPILER_APPICON_NAME： app icon
    7. VALID_ARCHS： 架构

  + 案例：

    1. ```
       name: LSDemo
       configs: 
       	Debug: debug
       	Beta: debug
       	AppStore: release
       targets:
       	LSDemo:
       		type: application
       		platform: iOS
       		deploymentTarget: "11.0"
       		sources:
       			- path: LSDemo
       		configFiles:
       			Debug: xcconfig/Debug.xcconfig
       			Beta: xcconfig/Beta.xcconfig
       			AppStore: xcconfig/AppStore.xcconfig
       		settings:
       			TARGETED_DEVICE_FAMILY: "1"
             ASSETCATALOG_COMPILER_APPICON_NAME: "AppIcon"
             VALID_ARCHS: "arm64"
       			
       ```

    2. 遇到的问题：

       1. configs和configFiles需要一一对应，不然会找不到
       2. ASSETCATALOG_COMPILER_APPICON_NAME 如果没有对应的asset，在编译最后拷贝资源时会找不到
       3. cocoapods的使用，在xcodegen官网文档中，也说了调用xcodegen之后，正常使用pod install即可，我这里因为自定义了xcconfig文件，cocoapods也会生成对应的xcconfig，pod install 时会有警告，因为丢失了cocoapods的xcconfig，我的解决办法是在自定义的xcconfig中，include了pod xcconfig的路径。因为引入了cocoapods的路径，看着有点丑陋，还没有更好的解决办法。

+ ### xcconfig相关 ([buildSettings中的配置](http://xcodebuildsettings.com/))

  + xcconfig可以互相引入，所以我声明了一个公共的Common.xcconfig，存放大家都有的属性

    + ```
      PRODUCT_NAME=项目名 
      MARKETING_VERSION=1.0.0 //版本号
      CURRENT_PROJECT_VERSION=1.0.0.0 //build号
      ENABLE_BITCODE=NO // bitcode
      GCC_PREFIX_HEADER=LSDemo/LSDemo.pch // pch文件路径
      LIBRARY_SEARCH_PATHS=$(inherited)
      OTHER_LDFLAGS=$(inherited)
      FRAMEWORK_SEARCH_PATHS=$(inherited)
      CLANG_WARN_DOCUMENTATION_COMMENTS=NO // 去掉文档中的警告
      ONLY_ACTIVE_ARCH=NO
      ```

    + 

  + 每个configuration可以单独配置

    + ```
      PRODUCT_BUNDLE_IDENTIFIER=com.ls.demo // bundle identifier
      GCC_PREPROCESSOR_DEFINITIONS= $(inherited) DEBUG=1 // macro下的定义
      CODE_SIGN_ENTITLEMENTS=LSDemo/Entitlements/LSDemoDebug.entitlements
      CODE_SIGN_STYLE=Manual // 手动签名
      DEVELOPMENT_TEAM=FRH5BS5C4C
      CODE_SIGN_IDENTITY=7EB0B9FB1D43465A8421C40337AE087A69872004
      PROVISIONING_PROFILE_SPECIFIER=6428e46d-aa47-409b-8def-efab2e93bcdb
      INFOPLIST_FILE=LSDemo/Info-Release.plist // info.plist 文件路径
      ```

    + iOS签名所需：引用自[Configure XCode Project Signing with xcconfig](https://ajpagente.github.io/mobile/using-xcconfig/)

      + Team Identifier：DEVELOPMENT_TEAM
      + Provisioning profile UUID： PROVISIONING_PROFILE_SPECIFIER
      + Development certificate SHA-1 hash：CODE_SIGN_IDENTITY
      + ![Signing parameters](https://ajpagente.github.io/assets/images/xcconfig/find-signing-parameters.png) 

    ### 遗留问题：

    + 拷贝资源时，info.plist不应该拷贝，也拷贝进去了
    + 文件不想参与编译，但是不想删除，暂时没有做到，文件夹路径下所有文件都会参与编译



